<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Course Manager</title>
    <link rel="stylesheet" th:href="@{/css/student-edit.css}">
    <link rel="stylesheet" th:href="@{/css/toast.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
<div class="toast" th:if="${successMsg} or ${errMsg}">
    <p th:if="${successMsg}" th:text="${successMsg}" style="color: green"></p>
    <p th:if="${errMsg}" th:text="${errMsg}" style="color: red"></p>
</div>

<!-- HEADER -->
<div th:replace="fragments/student-fragments :: header"></div>

<div class="dashboard-layout">

    <div class="student-form-header">
        <h2 class="student-form-title">Cập nhật thông tin tài khoản</h2>
        <button class="change-password-btn" th:href="@{/student/edit-password}" id="openChangePasswordModal">Đổi mật khẩu</button>
    </div>

    <!-- MAIN CONTENT -->
    <main class="student-form-container">
        <p th:text="${errMsg}" class="student-form-error global-error"></p>

        <form th:action="@{/student/update-student}" th:object="${studentUpdate}" method="post"
              enctype="multipart/form-data" class="student-form">

            <!-- Họ tên -->
            <div class="student-form-group">
                <label for="name" class="student-form-label">Họ tên</label>
                <input type="text" th:field="*{name}" id="name" class="student-form-input" placeholder="Nhập họ tên">
                <p th:errors="*{name}" class="student-form-error"></p>
            </div>

            <!-- Ngày sinh -->
            <div class="student-form-group">
                <label for="dob" class="student-form-label">Ngày sinh</label>
                <div class="input-wrapper">
                    <span class="icon"><img th:src="@{/images/date-icon.png}" alt="date"></span>
                    <input type="text" id="dob" th:field="*{dob}" placeholder="Chọn ngày sinh" readonly>
                </div>
                <p th:errors="*{dob}" class="student-form-error"></p>
            </div>

            <!-- Email -->
            <div class="student-form-group">
                <label for="email" class="student-form-label">Email</label>
                <input type="text" th:field="*{email}" id="email" class="student-form-input" placeholder="Nhập email">
                <p th:errors="*{email}" class="student-form-error"></p>
            </div>

            <!-- Giới tính -->
            <div class="student-form-group">
                <label class="student-form-label" for="sex">Giới tính</label>
                <select th:field="*{sex}" id="sex" class="student-form-input">
                    <option value="">-- Chọn giới tính --</option>
                    <option value="true">Nam</option>
                    <option value="false">Nữ</option>
                </select>
                <p th:errors="*{sex}" class="student-form-error"></p>
            </div>

            <!-- Số điện thoại -->
            <div class="student-form-group">
                <label for="phone" class="student-form-label">Số điện thoại</label>
                <input type="text" th:field="*{phone}" id="phone" class="student-form-input" placeholder="Nhập số điện thoại">
                <p th:errors="*{phone}" class="student-form-error"></p>
            </div>

            <!-- Submit -->
            <div class="student-form-actions">
                <button type="submit" class="student-form-button">Cập nhật</button>
            </div>
        </form>
    </main>
</div>

<!-- Change Password Modal -->
<div id="changePasswordModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Đổi mật khẩu</h2>
        <form th:action="@{/student/change-password}" th:object="${changePasswordDTO}" method="post" class="password-form">
            <div class="form-group">
                <label for="oldPassword">Mật khẩu cũ: <span>*</span></label>
                <input type="password" id="oldPassword" th:field="*{currentPassword}">
                <p th:errors="*{currentPassword}" class="student-form-error"></p>
            </div>

            <div class="form-group">
                <label for="newPassword">Mật khẩu mới: <span>*</span></label>
                <input type="password" id="newPassword" th:field="*{newPassword}">
                <p th:errors="*{newPassword}" class="student-form-error"></p>
            </div>

            <div class="form-group">
                <label for="confirmPassword">Nhập lại mật khẩu mới: <span>*</span></label>
                <input type="password" id="confirmPassword" th:field="*{confirmNewPassword}">
                <p th:errors="*{confirmNewPassword}" class="student-form-error"></p>
            </div>

            <div class="actions">
                <button type="button" class="cancel-btn" id="cancelBtn">Cancel</button>
                <button type="submit" class="save-btn">Save</button>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script th:src="@{/js/auth.js}"></script>
<script th:src="@{/js/toast.js}"></script>
<script th:inline="javascript">
    const modal = document.getElementById("changePasswordModal");
    const openBtn = document.getElementById("openChangePasswordModal");
    const closeBtn = document.querySelector(".close");
    const cancelBtn = document.getElementById("cancelBtn");

    openBtn.onclick = () => modal.style.display = "block";
    closeBtn.onclick = () => modal.style.display = "none";
    cancelBtn.onclick = () => modal.style.display = "none";

    // click ra ngoài modal cũng đóng
    window.onclick = (e) => {
        if (e.target === modal) modal.style.display = "none";
    }

    // Nếu controller set openModal=true thì mở modal ngay khi load
    const shouldOpen = /*[[${openModal}]]*/ false;
    if (shouldOpen) {
        modal.style.display = "block";
    }
</script>

</body>
</html>
